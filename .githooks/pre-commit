#!/bin/sh
# CSharpier pre-commit hook: checks formatting and auto-formats if needed

# Exit on error
set -e

# Ensure csharpier exists
command -v csharpier >/dev/null 2>&1 || {
  echo "csharpier not found in PATH; skipping formatting." >&2
  exit 0
}

echo "Running CSharpier check..."
if ! csharpier check .; then
  echo "Formatting with CSharpier..."
  csharpier format .
  # Stage any formatting changes
  git add -A
else
  echo "CSharpier: already formatted."
fi

# Enforce docs naming convention (lower-kebab-case for Markdown)
echo "Checking docs naming (kebab-case)..."
bad=""
for f in $(git ls-files "*.md"); do
  name=$(basename "$f")
  # Allow conventional exceptions
  echo "$name" | grep -Eq '^(README|DEVELOPING|CHANGELOG)\.md$|^[a-z0-9]+(-[a-z0-9]+)*\.md$' || bad="$bad\n$f"
done
if [ -n "$bad" ]; then
  echo "Docs naming check failed. Use lower-kebab-case for Markdown files (except README.md, DEVELOPING.md). Offenders:" >&2
  echo -e "$bad" >&2
  exit 1
fi

exit 0
